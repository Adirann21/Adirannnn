-- Initialize global variables
getgenv().on = true -- For Dark Chest Labeler
getgenv().a = true -- For Kill Aura

-- Functions to toggle each script
local function toggleChestLabeler()
    getgenv().on = not getgenv().on
    if not getgenv().on then
        print("Chest Labeler OFF")
        -- Cleanup: Remove all ChestGui elements
        for i, v in pairs(workspace.Map.Temporary:GetChildren()) do
            if v.Name == "Dark Sealed Chest" then
                local chestGui = v:FindFirstChild("ChestGui")
                if chestGui then
                    chestGui:Destroy()
                end
            end
        end
    else
        print("Chest Labeler ON")
    end
end

local function toggleKillAura()
    getgenv().a = not getgenv().a
    if getgenv().a then
        print("Kill Aura ON")
    else
        print("Kill Aura OFF")
    end
end

-- Create the GUI
local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ToggleGui"
screenGui.Parent = playerGui

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 300, 0, 200)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = true
mainFrame.Parent = screenGui

-- Red Header
local header = Instance.new("Frame")
header.Name = "Header"
header.Size = UDim2.new(1, 0, 0, 30)
header.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
header.BorderSizePixel = 0
header.Parent = mainFrame

local headerLabel = Instance.new("TextLabel")
headerLabel.Size = UDim2.new(1, 0, 1, 0)
headerLabel.BackgroundTransparency = 1
headerLabel.Text = "Toggle Features"
headerLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
headerLabel.Font = Enum.Font.GothamBold
headerLabel.TextSize = 18
headerLabel.Parent = header

-- Dragging functionality
local dragging = false
local dragInput, dragStart, startPos

header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Close Button
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -35, 0, 0)
closeButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 18
closeButton.Parent = header

closeButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
end)

-- Reopen GUI Button
local openButton = Instance.new("TextButton")
openButton.Size = UDim2.new(0, 100, 0, 50)
openButton.Position = UDim2.new(0, 10, 0.8, -60)
openButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
openButton.Text = "Open GUI"
openButton.TextColor3 = Color3.fromRGB(255, 255, 255)
openButton.Font = Enum.Font.GothamBold
openButton.TextSize = 18
openButton.Parent = screenGui

openButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = true
end)

-- Chest Labeler Button
local chestLabelButton = Instance.new("TextButton")
chestLabelButton.Name = "ChestLabelButton"
chestLabelButton.Size = UDim2.new(0, 200, 0, 50)
chestLabelButton.Position = UDim2.new(0.5, -100, 0.3, 0)
chestLabelButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
chestLabelButton.Text = "Chest Labeler (ON)"
chestLabelButton.TextColor3 = Color3.fromRGB(255, 255, 255)
chestLabelButton.Font = Enum.Font.Gotham
chestLabelButton.TextSize = 16
chestLabelButton.Parent = mainFrame

-- Kill Aura Button
local killAuraButton = Instance.new("TextButton")
killAuraButton.Name = "KillAuraButton"
killAuraButton.Size = UDim2.new(0, 200, 0, 50)
killAuraButton.Position = UDim2.new(0.5, -100, 0.5, 0)
killAuraButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
killAuraButton.Text = "Kill Aura (ON)"
killAuraButton.TextColor3 = Color3.fromRGB(255, 255, 255)
killAuraButton.Font = Enum.Font.Gotham
killAuraButton.TextSize = 16
killAuraButton.Parent = mainFrame

-- Button functionality
chestLabelButton.MouseButton1Click:Connect(function()
    toggleChestLabeler()
    if getgenv().on then
        chestLabelButton.Text = "Chest Labeler (ON)"
    else
        chestLabelButton.Text = "Chest Labeler (OFF)"
    end
end)

killAuraButton.MouseButton1Click:Connect(function()
    toggleKillAura()
    if getgenv().a then
        killAuraButton.Text = "Kill Aura (ON)"
    else
        killAuraButton.Text = "Kill Aura (OFF)"
    end
end)

-- Dark Chest Labeler Loop
spawn(function()
    while task.wait(0.25) do
        if not getgenv().on then
            continue
        end

        for i, v in pairs(workspace.Map.Temporary:GetChildren()) do
            if v.Name == "Dark Sealed Chest" then
                if v:FindFirstChild("ChestGui") == nil then
                    local billboardGui = Instance.new("BillboardGui")
                    billboardGui.Name = "ChestGui"
                    billboardGui.Size = UDim2.new(0, 100, 0, 50)
                    billboardGui.Adornee = v
                    billboardGui.AlwaysOnTop = true
                    billboardGui.Parent = v

                    local frame = Instance.new("Frame")
                    frame.Size = UDim2.new(1, 0, 1, 0)
                    frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                    frame.BackgroundTransparency = 0.5
                    frame.Parent = billboardGui

                    local label = Instance.new("TextLabel")
                    label.Size = UDim2.new(1, 0, 1, 0)
                    label.BackgroundTransparency = 1
                    label.TextColor3 = Color3.fromRGB(255, 255, 255)
                    label.Text = v.Name
                    label.Parent = frame
                end
            end
        end
    end
end)

-- Kill Aura Loop
spawn(function()
    while task.wait() do
        if not getgenv().a then
            continue
        end

        for i, v in pairs(workspace.Enemies:GetChildren()) do
            if v:IsA("Model") and v:FindFirstChildOfClass("Humanoid") and v:FindFirstChildOfClass("Humanoid").Health > 0 and game.Players.LocalPlayer:DistanceFromCharacter(v.PrimaryPart.Position) < 21 then
                local args = {
                    [1] = 0,
                    [2] = game:GetService("Players").LocalPlayer.Character,
                    [3] = v,
                    [4] = game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool"),
                    [5] = "Slash"
                }

                game:GetService("ReplicatedStorage").RS.Remotes.Combat.DealWeaponDamage:FireServer(unpack(args))
            end
        end
    end
end)
